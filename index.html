<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <!-- Improved viewport settings for mobile responsiveness -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta
      name="description"
      content="PharmX Pomodoro Timer: Enhance your productivity with focused 25-minute sessions followed by 5-minute breaks. Stay in the zone with PharmX."
    />
    <title>PharmX Pomodoro Timer</title>
    <!-- Import Mona Sans for all text -->
    <link
      href="https://fonts.googleapis.com/css2?family=Mona+Sans:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* Define custom properties for easy theming */
      :root {
        --primary-bg: #000;
        --primary-color: #fff;
        --accent-color: #08f;
        --gradient-bg: conic-gradient(
          from var(--border-angle, 0turn),
          #213,
          #112 5%,
          #112 60%,
          #213 95%
        );
      }
      /* Global Styles */
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        background: var(--primary-bg);
        font-family: "Mona Sans", sans-serif;
        color: var(--primary-color);
      }
      body {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: space-between;
        text-align: center;
        padding: 1rem;
        min-height: 100vh;
      }
      header,
      footer {
        width: 100%;
        text-align: center;
        padding: 1rem 0;
      }
      header {
        margin-top: 2rem;
      }
      footer {
        margin-bottom: 2rem;
      }
      #container {
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 90%;
        max-width: 1200px;
      }
      #title {
        font-size: 2rem;
        font-weight: bold;
        margin-bottom: 1rem;
        text-shadow: 0 0 8px var(--accent-color), 0 0 16px var(--accent-color);
      }
      #timerDisplay {
        font-size: 2rem;
        margin-bottom: 2rem;
        text-shadow: 0 0 8px var(--accent-color), 0 0 16px var(--accent-color),
          0 0 24px var(--accent-color);
      }
      .btn {
        padding: 1rem 2rem;
        font-size: 1.2rem;
        cursor: pointer;
        background: linear-gradient(45deg, var(--accent-color), #0ff);
        border: none;
        border-radius: 1rem;
        color: var(--primary-color);
        text-transform: uppercase;
        letter-spacing: 1px;
        box-shadow: 0 0 10px var(--accent-color), 0 0 20px var(--accent-color);
        transition: transform 0.2s, box-shadow 0.2s;
        margin-bottom: 1.5rem;
      }
      .btn:hover {
        transform: scale(1.05);
        box-shadow: 0 0 20px var(--accent-color), 0 0 30px var(--accent-color);
      }
      .btn:active {
        transform: scale(0.95);
      }
      #boxes {
        width: 100%;
      }
      .session-container {
        display: flex;
        justify-content: center;
        gap: 1rem;
        flex-wrap: wrap;
        margin-bottom: 1rem;
      }
      .battery-container {
        display: flex;
        justify-content: center;
        gap: 1rem;
        flex-wrap: wrap;
        margin-bottom: 3rem;
      }
      /* Session Box */
      .box {
        width: 30vmin;
        height: 30vmin;
        display: grid;
        place-content: center;
        position: relative;
        border: 5px solid transparent;
        border-radius: 2em;
        background: 
          var(--gradient-bg) padding-box,
          conic-gradient(from var(--border-angle, 0turn), transparent 25%, var(--accent-color), #f03 99%, transparent)
            border-box,
          var(--gradient-bg) border-box;
        background-position: center center;
        animation: bg-spin 3s linear infinite;
        overflow: hidden;
      }
      @keyframes bg-spin {
        to {
          --border-angle: 1turn;
        }
      }
      @property --border-angle {
        syntax: "<angle>";
        inherits: true;
        initial-value: 0turn;
      }
      .box:hover {
        animation-play-state: paused;
      }
      .box .fill {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 0%;
        background: linear-gradient(to top, var(--accent-color), #0ff);
        z-index: 1;
        transition: height 0.5s linear;
      }
      .box .content {
        position: relative;
        z-index: 2;
        font-size: 1.2rem;
      }
      /* Battery Indicator */
      .battery {
        width: 25vmin;
        height: 8vmin;
        border: 3px solid var(--primary-color);
        border-radius: 5px;
        position: relative;
        margin: 1rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      .battery .battery-body {
        width: 100%;
        height: 60%;
        background: transparent;
        position: relative;
        overflow: hidden;
      }
      .battery .battery-fill {
        height: 100%;
        width: 0%;
        background: linear-gradient(to right, #00ff00, #00cc00);
        transition: width 0.5s linear;
      }
      .battery::after {
        content: "";
        position: absolute;
        right: -10px;
        top: 30%;
        width: 8px;
        height: 40%;
        background: var(--primary-color);
        border-radius: 2px;
      }
      .battery-label {
        font-size: 0.9rem;
        margin-top: 0.2rem;
      }
      footer a {
        color: var(--primary-color);
        text-decoration: none;
        font-weight: bold;
        text-shadow: 0 0 5px var(--primary-color), 0 0 10px var(--primary-color),
          0 0 20px var(--primary-color);
      }
      /* Responsive Adjustments */
      @media (max-width: 768px) {
        #title {
          font-size: 1.8rem;
        }
        #timerDisplay {
          font-size: 1.8rem;
        }
        .btn {
          font-size: 1rem;
          padding: 0.8rem 1.5rem;
        }
        .box {
          width: 40vmin;
          height: 40vmin;
        }
        .battery {
          width: 40vmin;
          height: 12vmin;
        }
      }
      @media (max-width: 480px) {
        .box,
        .battery {
          width: 45vmin;
        }
        #title {
          font-size: 1.6rem;
        }
        .btn {
          font-size: 0.9rem;
          padding: 0.7rem 1.2rem;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1 id="title">Pomodoro Timer</h1>
    </header>
    <div id="container">
      <!-- Digital Timer Display -->
      <div id="timerDisplay">00:00</div>
      <!-- Start and Pause Buttons -->
      <div class="button-container">
        <button id="startBtn" class="btn">Start</button>
        <button id="pauseBtn" class="btn" style="display: none;">Pause</button>
      </div>
      <!-- Session Boxes and Battery Indicators -->
      <div id="boxes">
        <div class="session-container">
          <div class="box" data-session="1">
            <div class="fill"></div>
            <div class="content">Session 1</div>
          </div>
          <div class="box" data-session="2">
            <div class="fill"></div>
            <div class="content">Session 2</div>
          </div>
          <div class="box" data-session="3">
            <div class="fill"></div>
            <div class="content">Session 3</div>
          </div>
        </div>
        <div class="battery-container">
          <div class="battery" data-break="1">
            <div class="battery-body">
              <div class="battery-fill"></div>
            </div>
            <div class="battery-label">5 Minute Break</div>
          </div>
          <div class="battery" data-break="2">
            <div class="battery-body">
              <div class="battery-fill"></div>
            </div>
            <div class="battery-label">5 Minute Break</div>
          </div>
          <div class="battery" data-break="3">
            <div class="battery-body">
              <div class="battery-fill"></div>
            </div>
            <div class="battery-label">5 Minute Break</div>
          </div>
        </div>
      </div>
    </div>
    <footer>
      Focus with
      <a href="https://linktr.ee/pharmx" target="_blank" rel="noopener noreferrer">PharmX</a>
    </footer>
    <!-- Audio Alert -->
    <audio id="alertSound" src="https://pharmx.co.uk/congrats.mp3" preload="auto"></audio>
    <script>
      const SESSION_DURATION = 1500; // 25 minutes in seconds
      const BREAK_DURATION = 300;    // 5 minutes in seconds
      
      const sessionBoxes = document.querySelectorAll('.box');
      const batteryIndicators = document.querySelectorAll('.battery');
      const timerDisplay = document.getElementById('timerDisplay');
      const startBtn = document.getElementById('startBtn');
      const pauseBtn = document.getElementById('pauseBtn');
      const alertSound = document.getElementById('alertSound');
      
      let currentSessionIndex = 0;
      let mode = "idle"; // "idle", "session", or "break"
      let remainingTime = SESSION_DURATION;
      let timerInterval = null;
      let isPaused = false;
      
      // Utility: Format seconds as MM:SS.
      function formatTime(seconds) {
        const m = Math.floor(seconds / 60);
        const s = seconds % 60;
        return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
      }
      
      // Update UI based on current mode.
      function updateUI() {
        if (mode === "session") {
          timerDisplay.textContent = formatTime(remainingTime);
          const progress = ((SESSION_DURATION - remainingTime) / SESSION_DURATION) * 100;
          sessionBoxes[currentSessionIndex].querySelector('.fill').style.height = progress + '%';
        } else if (mode === "break") {
          timerDisplay.textContent = formatTime(remainingTime);
          const progress = ((BREAK_DURATION - remainingTime) / BREAK_DURATION) * 100;
          if (batteryIndicators[currentSessionIndex]) {
            batteryIndicators[currentSessionIndex].querySelector('.battery-fill').style.width = progress + '%';
          }
        }
      }
      
      // Timer tick function.
      function tick() {
        if (!isPaused) {
          remainingTime--;
          updateUI();
          if (remainingTime <= 0) {
            clearInterval(timerInterval);
            if (mode === "session") {
              sessionBoxes[currentSessionIndex].querySelector('.fill').style.height = '100%';
              alertSound.play().catch(error => console.error("Sound error:", error));
              mode = "break";
              remainingTime = BREAK_DURATION;
              batteryIndicators[currentSessionIndex].querySelector('.battery-fill').style.width = '0%';
              updateUI();
              timerInterval = setInterval(tick, 1000);
            } else if (mode === "break") {
              if (batteryIndicators[currentSessionIndex]) {
                batteryIndicators[currentSessionIndex].querySelector('.battery-fill').style.width = '100%';
              }
              alertSound.play().catch(error => console.error("Sound error:", error));
              currentSessionIndex++;
              if (currentSessionIndex < sessionBoxes.length) {
                mode = "idle";
                remainingTime = SESSION_DURATION;
                timerDisplay.textContent = "00:00";
                startBtn.textContent = "Start";
                startBtn.style.display = "inline-block";
                pauseBtn.style.display = "none";
              } else {
                timerDisplay.textContent = "All sessions completed!";
                startBtn.textContent = "Reset";
                startBtn.style.display = "inline-block";
                pauseBtn.style.display = "none";
              }
            }
          }
        }
      }
      
      // Start Button: Begin session.
      startBtn.addEventListener('click', () => {
        if (mode === "idle" || currentSessionIndex >= sessionBoxes.length) {
          if (currentSessionIndex >= sessionBoxes.length) {
            // Reset the timer
            currentSessionIndex = 0;
            sessionBoxes.forEach(box => box.querySelector('.fill').style.height = '0%');
            batteryIndicators.forEach(battery => battery.querySelector('.battery-fill').style.width = '0%');
          }
          mode = "session";
          remainingTime = SESSION_DURATION;
          startBtn.style.display = "none";
          pauseBtn.style.display = "inline-block";
          updateUI();
          timerInterval = setInterval(tick, 1000);
        }
      });
      
      // Pause Button: Pause/Resume the timer.
      pauseBtn.addEventListener('click', () => {
        isPaused = !isPaused;
        pauseBtn.textContent = isPaused ? "Resume" : "Pause";
      });
    </script>
  </body>
</html>
